@if (!isSelf()) {
@if (!isOpen()) {
<button class="ai-widget-button btn btn-primary rounded-circle shadow-lg" (click)="toggleWidget()"
  *transloco="let t; prefix: 'vtes_ai'" [title]="t('title')">
  <i class="bi bi-chat-dots-fill fs-4"></i>
</button>
}

@if (isOpen()) {
<div class="ai-widget-container shadow-lg rounded border bg-body" *transloco="let t; prefix: 'vtes_ai'">
  <div class="ai-widget-header bg-primary text-white p-3 d-flex justify-content-between align-items-center">
    <div class="d-flex gap-2 align-items-center">
      <h6 class="mb-0 me-2">
        {{ t('title') }}
        <span class="badge bg-warning text-dark ms-1 fs-9">BETA</span>
      </h6>
      <button class="btn btn-sm btn-link text-white p-0 text-decoration-none" (click)="newChat()"
        [title]="t('new_chat')">
        <i class="bi bi-plus-circle me-1"></i>{{ t('new') }}
      </button>
      <div ngbDropdown container="body" class="d-inline-block">
        <button class="btn btn-sm btn-link text-white p-0 text-decoration-none" ngbDropdownToggle
          [title]="t('history')">
          <i class="bi bi-clock-history me-1"></i>{{ t('history') }}
        </button>
        <div ngbDropdownMenu class="dropdown-menu-end" style="max-height: 300px; overflow-y: auto;">
          @for (chat of (chats$ | async)?.slice()?.reverse(); track chat.id) {
          <button class="dropdown-item" [class.active]="chat.id === (activeChat$ | async)?.id"
            (click)="switchActiveChat(chat.id)">
            <i class="bi bi-chat-dots me-2"></i><span class="text-truncate">{{ chat.title | truncate }}</span>
          </button>
          }
        </div>
      </div>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-link text-white p-0" routerLink="/vtes-ai" [title]="t('maximize')">
        <i class="bi bi-arrows-fullscreen"></i>
      </button>
      <button class="btn btn-sm btn-link text-white p-0" (click)="closeWidget()" [title]="t('close')">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>
  <div class="ai-widget-body">
    <app-vtes-ai [widgetMode]="true"></app-vtes-ai>
  </div>
</div>
}
}