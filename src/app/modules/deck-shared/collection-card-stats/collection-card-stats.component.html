<ng-container *transloco="let t; prefix: 'deck_shared'">
  @if (collectionStats(); as collectionStats) {
  @if (collectionStats.decks && collectionStats.decks.total > 0) {
  <div class="card border-0 shadow-sm mt-3">
    <div class="card-header bg-primary text-white py-2" role="button" (click)="decksCollapsed = !decksCollapsed"
      (keyup.enter)="decksCollapsed = !decksCollapsed" (keyup.space)="decksCollapsed = !decksCollapsed" tabindex="0">
      <h6 class="mb-0 fw-bold d-flex align-items-center justify-content-between">
        <span>
          <i class="bi bi-collection me-2"></i>{{ t('my_decks') }}
          <span class="badge ms-2" [ngClass]="{
            'bg-danger': collectionStats.collectionNumber < collectionStats.decksNumber ,
            'bg-dark':  collectionStats.collectionNumber >= collectionStats.decksNumber
          }"
            [title]="t('cards_in_collection_tooltip', { collected: collectionStats.collectionNumber, total: collectionStats.decksNumber })">
            {{ collectionStats.decksNumber }}
          </span>
        </span>
        <i class="bi" [class.bi-chevron-down]="!decksCollapsed" [class.bi-chevron-right]="decksCollapsed"></i>
      </h6>
    </div>
    <div class="card-body p-2" [ngbCollapse]="decksCollapsed" #decksCollapse="ngbCollapse">
      @for (deck of collectionStats.decks.decks; track deck; let last = $last) {
      <div class="d-flex align-items-center py-1 border-dark" [class.border-bottom]="!last">
        <a class="text-decoration-none flex-grow-1" [routerLink]="'/deck/'+deck.id" (click)="routerClick.emit(true)">
          @if( deck.filterCards?.[0]?.number; as number ){
          <span class="badge bg-primary me-2">{{ number }}x</span>
          }
          <span class="fw-medium">{{ deck.name }}</span>
          @if(deck.collection){
          <i class="ms-1 text-success bi bi-fs-1_2x bi-check2-circle" [ngbTooltip]="t('tracked_collection')"></i>
          }
        </a>
      </div>
      }
    </div>
  </div>
  }
  @if (collectionStats.collectionNumber > 0) {
  <div class="card border-0 shadow-sm mt-3">
    <div class="card-header bg-secondary text-white py-2" role="button"
      (click)="collectionCollapsed = !collectionCollapsed" (keyup.enter)="collectionCollapsed = !collectionCollapsed"
      (keyup.space)="collectionCollapsed = !collectionCollapsed" tabindex="0">
      <h6 class="mb-0 fw-bold d-flex align-items-center justify-content-between">
        <span>
          <i class="bi bi-archive me-2"></i>{{ t('my_collection') }}
          <span class="badge bg-dark ms-2">{{ collectionStats.collectionNumber }}</span>
        </span>
        <i class="bi" [class.bi-chevron-down]="!collectionCollapsed" [class.bi-chevron-right]="collectionCollapsed"></i>
      </h6>
    </div>
    <div class="card-body p-2" [ngbCollapse]="collectionCollapsed" #collectionCollapse="ngbCollapse">
      @for (card of collectionStats.collectionCards; track card; let last = $last) {
      <div class="d-flex align-items-center justify-content-between py-1 border-dark" [class.border-bottom]="!last">
        <div class="flex-grow-1">
          <span class="badge bg-primary me-2">{{ card.number }}x</span>
          <span class="fw-medium">{{ card.cardName }}</span>
        </div>
        <div class="d-flex gap-1">
          @if(card.set) {
          <span class="badge bg-secondary" #tooltip="ngbTooltip" [ngbTooltip]="setContent" tabindex="0"
            triggers="mouseenter:mouseleave" container="body" (click)="tooltip.open()" (keyup)="tooltip.open()">
            {{ card.set }}
            <ng-template #setContent>
              <app-set-tooltip [cardId]="card.cardId" [set]="card.set" />
            </ng-template>
          </span>
          }
          @if(card.language) {
          <span class="badge bg-info">{{ card.language }}</span>
          }
        </div>
      </div>
      }
      <div class="text-center">
        <a class="btn btn-outline-success btn-sm" [routerLink]="'/collection'"
          [queryParams]="{ cardName: collectionStats.collectionCards?.[0]?.cardName }" (click)="routerClick.emit(true)">
          <i class="bi bi-eye me-1"></i>{{ t('view_collection') }}
        </a>
      </div>
    </div>
  </div>
  }
  }
</ng-container>