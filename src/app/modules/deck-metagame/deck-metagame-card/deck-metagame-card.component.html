@if(archetype(); as archetype){
@let isMaintainer = isMaintainer$ | async;
<div class="metagame-card rounded-3 h-100 overflow-hidden bg-body d-flex flex-column"
  *transloco="let t; prefix: 'deck_metagame'">
  <!-- Header Section -->
  <div class="metagame-header px-3 pt-3 pb-2">
    <div class="d-flex align-items-start justify-content-between mb-2">
      <div class="d-flex align-items-center flex-grow-1">
        @if (archetype.icon) {
        <div class="icon-wrapper d-inline-flex align-items-center justify-content-center rounded-2 me-2">
          <i class="vtes" [class]="archetype.icon"></i>
        </div>
        }
        <div class="flex-grow-1">
          <h5 class="card-title mb-1 fw-bold text-body">
            @if(archetype.id === undefined && isMaintainer){
            <button class="btn btn-link text-start fw-bold text-decoration-none p-0" (click)="openModal(archetype)">
              {{ archetype.name }}
            </button>
            } @else if(archetype.deckId) {
            <a class="text-decoration-none text-body" [routerLink]="['/deck', archetype.deckId]">{{ archetype.name
              }}</a>
            }@else if (archetype.id !== undefined) {
            <a class="text-decoration-none text-body" [routerLink]="['/decks']"
              [queryParams]="{ archetype: archetype.id }">
              {{ archetype.name }}
            </a>
            }@else {
            {{ archetype.name }}
            }
          </h5>
          <div class="card-subtitle text-muted small">{{ archetype.type }}</div>
        </div>
      </div>
      @if (isMaintainer && archetype.id && archetype.id > 0) {
      <div class="d-flex align-items-center gap-2">
        <span class="status-badge" [class.status-enabled]="archetype.enabled"
          [class.status-disabled]="!archetype.enabled">
          @if (archetype.enabled) {
          <i class="bi bi-check-circle-fill"></i>
          } @else {
          <i class="bi bi-x-circle-fill"></i>
          }
        </span>
        <button class="btn btn-sm btn-outline-secondary" (click)="openModal(archetype)">
          <i class="bi bi-pencil-fill"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger" (click)="delete(archetype)">
          <i class="bi bi-trash-fill"></i>
        </button>
      </div>
      }
    </div>
  </div>

  <!-- Description Section -->
  <div class="metagame-body flex-grow-1 px-3 py-2">
    <div class="description-content text-secondary small">
      <app-markdown-text [data]="archetype.description"></app-markdown-text>
    </div>
  </div>

  <!-- Footer Section -->
  <div class="metagame-footer px-3 py-2 border-top border-opacity-10">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
      <div class="d-flex align-items-center gap-2 flex-wrap" placement="top" [ngbTooltip]="t('meta', {
      percentage: (metaPercentage | number:'1.0-2'),
      count: archetype.metaCount
    })">
        <span class="stat-badge d-inline-flex align-items-center px-2 py-1 rounded-2 small fw-medium">
          <i class="bi bi-bar-chart-fill me-1"></i>
          <span class="fw-semibold">{{ metaPercentage | number:'1.0-2' }}%</span>
        </span>
        <span class="stat-badge d-inline-flex align-items-center px-2 py-1 rounded-2 small fw-medium">
          <i class="bi bi-collection-fill me-1"></i>
          <span>{{ archetype.metaCount }}</span>
        </span>
        @if(archetype.price) {
        <span class="stat-badge d-inline-flex align-items-center px-2 py-1 rounded-2 small fw-semibold">
          <i class="bi bi-tag-fill me-1"></i>
          {{ archetype.price | currency: archetype.currency }}
        </span>
        }
      </div>
      @if(archetype.id !== undefined) {
      <a class="view-decks-link d-inline-flex align-items-center text-decoration-none" [routerLink]="['/decks']"
        [queryParams]="{ archetype: archetype.id }" [attr.aria-label]="t('decks_with_metagame')">
        <span class="small fw-medium">{{ t('decks_with_metagame') }}</span>
        @if(archetype.deckCount > 0) {
        <span class="count-badge ms-2 d-inline-flex align-items-center justify-content-center rounded-2">{{
          archetype.deckCount }}</span>
        }
        <i class="bi bi-arrow-right ms-1"></i>
      </a>
      }
    </div>
  </div>
</div>
}